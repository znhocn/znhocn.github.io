<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>YubiKey 4 PGP 功能使用教程 | ZnHoCn&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="YubiKey 是一款用于安全认证的硬件工具，其中的 YubiKey 4, YubiKey 4 Nano, YubiKey 4C, YubiKey NEO, YubiKey NEO-n，这些产品型号是包含 OpenPGP Card 功能的。
你可将你的私钥移动到 YubiKey 里，在需要使用的时候插上，而不必担心私钥泄露或被恶意程序盗取，并且支持在多种操作系统上使用。">
<meta property="og:type" content="article">
<meta property="og:title" content="YubiKey 4 PGP 功能使用教程">
<meta property="og:url" content="https://znhocn.github.io/posts/2017/06/03/YubiKey-4-GPG-Tutorial/index.html">
<meta property="og:site_name" content="ZnHoCn's Blog">
<meta property="og:description" content="YubiKey 是一款用于安全认证的硬件工具，其中的 YubiKey 4, YubiKey 4 Nano, YubiKey 4C, YubiKey NEO, YubiKey NEO-n，这些产品型号是包含 OpenPGP Card 功能的。
你可将你的私钥移动到 YubiKey 里，在需要使用的时候插上，而不必担心私钥泄露或被恶意程序盗取，并且支持在多种操作系统上使用。">
<meta property="og:updated_time" content="2017-06-05T19:27:00.989Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="YubiKey 4 PGP 功能使用教程">
<meta name="twitter:description" content="YubiKey 是一款用于安全认证的硬件工具，其中的 YubiKey 4, YubiKey 4 Nano, YubiKey 4C, YubiKey NEO, YubiKey NEO-n，这些产品型号是包含 OpenPGP Card 功能的。
你可将你的私钥移动到 YubiKey 里，在需要使用的时候插上，而不必担心私钥泄露或被恶意程序盗取，并且支持在多种操作系统上使用。">
  
    <link rel="alternate" href="/atom.xml" title="ZnHoCn&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ZnHoCn&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://znhocn.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-YubiKey-4-GPG-Tutorial" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/posts/2017/06/03/YubiKey-4-GPG-Tutorial/" class="article-date">
  <time datetime="2017-06-02T16:23:15.000Z" itemprop="datePublished">2017-06-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      YubiKey 4 PGP 功能使用教程
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://www.yubico.com/" target="_blank" rel="external">YubiKey</a> 是一款用于安全认证的硬件工具，其中的 YubiKey 4, YubiKey 4 Nano, YubiKey 4C, YubiKey NEO, YubiKey NEO-n，这些产品型号是包含 OpenPGP Card 功能的。</p>
<p>你可将你的私钥移动到 YubiKey 里，在需要使用的时候插上，而不必担心私钥泄露或被恶意程序盗取，并且支持在多种操作系统上使用。</p>
<a id="more"></a>
<h2 id="1、生成密钥对"><a href="#1、生成密钥对" class="headerlink" title="1、生成密钥对"></a>1、生成密钥对</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">$ gpg --gen-key</div><div class="line"></div><div class="line">gpg (GnuPG) 2.0.30; Copyright (C) 2015 Free Software Foundation, Inc.</div><div class="line">This is free software: you are free to change and redistribute it.</div><div class="line">There is NO WARRANTY, to the extent permitted by law.</div><div class="line"></div><div class="line">Please select what kind of key you want:</div><div class="line">   (1) RSA and RSA (default)</div><div class="line">   (2) DSA and Elgamal</div><div class="line">   (3) DSA (sign only)</div><div class="line">   (4) RSA (sign only)</div><div class="line">Your selection? 1  // 输入 1 选择默认的 RSA 加密算法</div><div class="line">RSA keys may be between 1024 and 4096 bits long.</div><div class="line">What keysize <span class="keyword">do</span> you want? (2048) 4096</div><div class="line">Requested keysize is 4096 bits</div><div class="line">Please specify how long the key should be valid.</div><div class="line">         0 = key does not expire</div><div class="line">      &lt;n&gt;  = key expires <span class="keyword">in</span> n days</div><div class="line">      &lt;n&gt;w = key expires <span class="keyword">in</span> n weeks</div><div class="line">      &lt;n&gt;m = key expires <span class="keyword">in</span> n months</div><div class="line">      &lt;n&gt;y = key expires <span class="keyword">in</span> n years</div><div class="line">Key is valid <span class="keyword">for</span>? (0)  // 直接回车选择 0 默认永不过期</div><div class="line">Key does not expire at all</div><div class="line">Is this correct? (y/N) y  // 输入 y 确定 下一步</div><div class="line"></div><div class="line">GnuPG needs to construct a user ID to identify your key.</div><div class="line"></div><div class="line">Real name: Test User  // 输入你的姓名</div><div class="line">Email address: <span class="built_in">test</span>@example.com  // 输入你的邮箱</div><div class="line">Comment:  // 输入你的附加信息，可以是你的网络 ID 名称，或者直接回车跳过</div><div class="line">You selected this USER-ID:</div><div class="line">    <span class="string">"Test User &lt;test@example.com&gt;"</span></div><div class="line"></div><div class="line">Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? o  // 输入 o 回车后会要求你设置一个私钥的密码</div><div class="line">You need a Passphrase to protect your secret key.</div><div class="line"></div><div class="line">We need to generate a lot of random bytes. It is a good idea to perform</div><div class="line">some other action (<span class="built_in">type</span> on the keyboard, move the mouse, utilize the</div><div class="line">disks) during the prime generation; this gives the random number</div><div class="line">generator a better chance to gain enough entropy.</div><div class="line">We need to generate a lot of random bytes. It is a good idea to perform</div><div class="line">some other action (<span class="built_in">type</span> on the keyboard, move the mouse, utilize the</div><div class="line">disks) during the prime generation; this gives the random number</div><div class="line">generator a better chance to gain enough entropy.</div><div class="line">gpg: key A8C37A46 marked as ultimately trusted</div><div class="line">public and secret key created and signed.</div><div class="line"></div><div class="line">gpg: checking the trustdb</div><div class="line">gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model</div><div class="line">gpg: depth: 0  valid:   2  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 2u</div><div class="line">pub   4096R/F891791F 2017-05-29</div><div class="line">      Key fingerprint = 628C 7B5D D284 224A 3321  4369 BC71 9F68 F891 791F</div><div class="line">uid       [ultimate] Test User &lt;<span class="built_in">test</span>@example.com&gt;</div><div class="line">sub   4096R/46D4D220 2017-05-29</div></pre></td></tr></table></figure>
<h2 id="2、添加验证密钥"><a href="#2、添加验证密钥" class="headerlink" title="2、添加验证密钥"></a>2、添加验证密钥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div></pre></td><td class="code"><pre><div class="line">$ gpg --expert --edit-key F891791F</div><div class="line"></div><div class="line">gpg (GnuPG) 2.0.30; Copyright (C) 2015 Free Software Foundation, Inc.</div><div class="line">This is free software: you are free to change and redistribute it.</div><div class="line">There is NO WARRANTY, to the extent permitted by law.</div><div class="line"></div><div class="line">Secret key is available.</div><div class="line"></div><div class="line">pub  4096R/F891791F  created: 2017-05-29  expires: never       usage: SC</div><div class="line">                     trust: ultimate      validity: ultimate</div><div class="line">sub  4096R/46D4D220  created: 2017-05-29  expires: never       usage: E</div><div class="line">[ultimate] (1). Test User &lt;<span class="built_in">test</span>@example.com&gt;</div><div class="line"></div><div class="line">gpg&gt; addkey</div><div class="line">This key is not protected.</div><div class="line">Please select what kind of key you want:</div><div class="line">   (3) DSA (sign only)</div><div class="line">   (4) RSA (sign only)</div><div class="line">   (5) Elgamal (encrypt only)</div><div class="line">   (6) RSA (encrypt only)</div><div class="line">   (7) DSA (<span class="built_in">set</span> your own capabilities)</div><div class="line">   (8) RSA (<span class="built_in">set</span> your own capabilities)</div><div class="line">Your selection? 8</div><div class="line"></div><div class="line">Possible actions <span class="keyword">for</span> a RSA key: Sign Encrypt Authenticate</div><div class="line">Current allowed actions: Sign Encrypt</div><div class="line"></div><div class="line">   (S) Toggle the sign capability</div><div class="line">   (E) Toggle the encrypt capability</div><div class="line">   (A) Toggle the authenticate capability</div><div class="line">   (Q) Finished</div><div class="line"></div><div class="line">Your selection? A</div><div class="line"></div><div class="line">Possible actions <span class="keyword">for</span> a RSA key: Sign Encrypt Authenticate</div><div class="line">Current allowed actions: Sign Encrypt Authenticate</div><div class="line"></div><div class="line">   (S) Toggle the sign capability</div><div class="line">   (E) Toggle the encrypt capability</div><div class="line">   (A) Toggle the authenticate capability</div><div class="line">   (Q) Finished</div><div class="line"></div><div class="line">Your selection? S</div><div class="line"></div><div class="line">Possible actions <span class="keyword">for</span> a RSA key: Sign Encrypt Authenticate</div><div class="line">Current allowed actions: Encrypt Authenticate</div><div class="line"></div><div class="line">   (S) Toggle the sign capability</div><div class="line">   (E) Toggle the encrypt capability</div><div class="line">   (A) Toggle the authenticate capability</div><div class="line">   (Q) Finished</div><div class="line"></div><div class="line">Your selection? E</div><div class="line"></div><div class="line">Possible actions <span class="keyword">for</span> a RSA key: Sign Encrypt Authenticate</div><div class="line">Current allowed actions: Authenticate</div><div class="line"></div><div class="line">   (S) Toggle the sign capability</div><div class="line">   (E) Toggle the encrypt capability</div><div class="line">   (A) Toggle the authenticate capability</div><div class="line">   (Q) Finished</div><div class="line"></div><div class="line">Your selection? Q</div><div class="line">RSA keys may be between 1024 and 4096 bits long.</div><div class="line">What keysize <span class="keyword">do</span> you want? (2048) 4096</div><div class="line">Requested keysize is 4096 bits</div><div class="line">Please specify how long the key should be valid.</div><div class="line">         0 = key does not expire</div><div class="line">      &lt;n&gt;  = key expires <span class="keyword">in</span> n days</div><div class="line">      &lt;n&gt;w = key expires <span class="keyword">in</span> n weeks</div><div class="line">      &lt;n&gt;m = key expires <span class="keyword">in</span> n months</div><div class="line">      &lt;n&gt;y = key expires <span class="keyword">in</span> n years</div><div class="line">Key is valid <span class="keyword">for</span>? (0)</div><div class="line">Key does not expire at all</div><div class="line">Is this correct? (y/N) y</div><div class="line">Really create? (y/N) y</div><div class="line">We need to generate a lot of random bytes. It is a good idea to perform</div><div class="line">some other action (<span class="built_in">type</span> on the keyboard, move the mouse, utilize the</div><div class="line">disks) during the prime generation; this gives the random number</div><div class="line">generator a better chance to gain enough entropy.</div><div class="line"></div><div class="line">pub  4096R/F891791F  created: 2017-05-29  expires: never       usage: SC</div><div class="line">                     trust: ultimate      validity: ultimate</div><div class="line">sub  4096R/46D4D220  created: 2017-05-29  expires: never       usage: E</div><div class="line">sub  4096R/C10AE6D4  created: 2017-05-29  expires: never       usage: A</div><div class="line">[ultimate] (1). Test User &lt;<span class="built_in">test</span>@example.com&gt;</div><div class="line"></div><div class="line">gpg&gt; q</div><div class="line">Save changes? (y/N) y</div></pre></td></tr></table></figure>
<h2 id="3、备份密钥"><a href="#3、备份密钥" class="headerlink" title="3、备份密钥"></a>3、备份密钥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">gpg --armor --output public-key.asc --export F891791F  // 导出公钥到文件</div><div class="line">gpg --armor --output private-key.asc --export-secret-keys F891791F  // 导出私钥到文件</div><div class="line">gpg --armor --output subkeys-key.asc --export-secret-subkeys F891791F  // 导出子钥到文件</div></pre></td></tr></table></figure>
<h2 id="4、设置-OpenPGP-卡"><a href="#4、设置-OpenPGP-卡" class="headerlink" title="4、设置 OpenPGP 卡"></a>4、设置 OpenPGP 卡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div></pre></td><td class="code"><pre><div class="line">$ gpg --card-edit</div><div class="line"></div><div class="line">Application ID ...: D2760001240102000060000000420000</div><div class="line">Version ..........: 2.1</div><div class="line">Manufacturer .....: Yubico</div><div class="line">Serial number ....: 00000042</div><div class="line">Name of cardholder: [not <span class="built_in">set</span>]</div><div class="line">Language prefs ...: [not <span class="built_in">set</span>]</div><div class="line">Sex ..............: unspecified</div><div class="line">URL of public key : [not <span class="built_in">set</span>]</div><div class="line">Login data .......: [not <span class="built_in">set</span>]</div><div class="line">Signature PIN ....: forced</div><div class="line">Key attributes ...: 2048R 2048R 2048R</div><div class="line">Max. PIN lengths .: 127 127 127</div><div class="line">PIN retry counter : 3 0 3</div><div class="line">Signature counter : 0</div><div class="line">Signature key ....: [none]</div><div class="line">Encryption key....: [none]</div><div class="line">Authentication key: [none]</div><div class="line">General key info..: [none]</div><div class="line"></div><div class="line">gpg/card&gt; admin  // 进入管理员模式</div><div class="line">Admin commands are allowed</div><div class="line"></div><div class="line">gpg/card&gt; passwd  // 设置密码</div><div class="line">gpg: OpenPGP card no. D2760001240102000060000000420000 detected</div><div class="line"></div><div class="line">1 - change PIN</div><div class="line">2 - unblock PIN</div><div class="line">3 - change Admin PIN</div><div class="line">4 - <span class="built_in">set</span> the Reset Code</div><div class="line">Q - quit</div><div class="line"></div><div class="line">Your selection? 1  // 输入 1 选择设置普通 PIN 码，默认的 PIN 码为 123456 如果是新设备或重置后的都是默认码。</div><div class="line">PIN changed.       // 设置时会先要求你输入普通 PIN 码的当前的密码，然后是设置新的 PIN 码，再是新的 PIN 码的二次确认。如果当前的 PIN 码输错 3 次就会被锁。</div><div class="line"></div><div class="line">1 - change PIN</div><div class="line">2 - unblock PIN</div><div class="line">3 - change Admin PIN</div><div class="line">4 - <span class="built_in">set</span> the Reset Code</div><div class="line">Q - quit</div><div class="line"></div><div class="line">Your selection? 3  // 输入 3 选择设置 Admin PIN 码，默认的 PIN 码为 12345678 如果是新设备或重置后的都是默认码。</div><div class="line">PIN changed.       // 设置时会先要求你输入 Admin PIN 码的当前的密码，然后是设置新的 PIN 码，再是新的 PIN 码的二次确认。如果当前的 PIN 码输错 3 次就会被锁。</div><div class="line"></div><div class="line">1 - change PIN</div><div class="line">2 - unblock PIN</div><div class="line">3 - change Admin PIN</div><div class="line">4 - <span class="built_in">set</span> the Reset Code</div><div class="line">Q - quit</div><div class="line"></div><div class="line">Your selection? 2  // （可选）输入 2 选择设置 unblock PIN 码，也就解锁码，用于在普通 PIN 码被锁后解锁并重置新的普通 PIN 码。unblock PIN 码只能用于解锁普通 PIN 码，无法用于 Admin PIN 码。</div><div class="line">PIN unblocked and new PIN set.  // 设置时会先要求你输入 Admin PIN 码的当前的密码，然后是设置新的 unblock PIN 码，再是新的 unblock PIN 码的二次确认。</div><div class="line"></div><div class="line">1 - change PIN</div><div class="line">2 - unblock PIN</div><div class="line">3 - change Admin PIN</div><div class="line">4 - <span class="built_in">set</span> the Reset Code</div><div class="line">Q - quit</div><div class="line"></div><div class="line">Your selection? q  // 输入 q 退出密码设置</div><div class="line"></div><div class="line">gpg/card&gt; name  // 设置姓名</div><div class="line">Cardholder<span class="string">'s surname: User  // 持卡人的姓</span></div><div class="line">Cardholder's given name: Test  // 持卡人的名字</div><div class="line"></div><div class="line">gpg/card&gt; lang  // 设置语言</div><div class="line">Language preferences: en</div><div class="line"></div><div class="line">gpg/card&gt; sex  // 设置性别 M 为男性 F 为女性</div><div class="line">Sex ((M)ale, (F)emale or space): m</div><div class="line"></div><div class="line">gpg/card&gt; url  // 设置公钥的网络链接</div><div class="line">URL to retrieve public key: https://www.example.com/public-key.asc  // 链接地址</div><div class="line"></div><div class="line">gpg/card&gt; login  // 设置用户名</div><div class="line">Login data (account name): <span class="built_in">test</span></div><div class="line"></div><div class="line">gpg/card&gt; </div><div class="line"></div><div class="line">Application ID ...: D2760001240102000060000000420000</div><div class="line">Version ..........: 2.1</div><div class="line">Manufacturer .....: Yubico</div><div class="line">Serial number ....: 00000042</div><div class="line">Name of cardholder: Test User</div><div class="line">Language prefs ...: en</div><div class="line">Sex ..............: male</div><div class="line">URL of public key : https://www.example.com/public-key.asc</div><div class="line">Login data .......: <span class="built_in">test</span></div><div class="line">Signature PIN ....: forced</div><div class="line">Key attributes ...: 2048R 2048R 2048R</div><div class="line">Max. PIN lengths .: 127 127 127</div><div class="line">PIN retry counter : 3 3 3  // 3 3 3 分别表示普通 PIN 码、unblock PIN 码、Admin PIN 码的输入错误计数器，默认为 3 输错一次减 1 ，减到 0 会被锁，被锁之前输入正确的 PIN 码会自动还原计数器。</div><div class="line">Signature counter : 0</div><div class="line">Signature key ....: [none]</div><div class="line">Encryption key....: [none]</div><div class="line">Authentication key: [none]</div><div class="line">General key info..: [none]</div><div class="line"></div><div class="line">gpg/card&gt; quit  // 退出 OpenPGP 卡设置</div></pre></td></tr></table></figure>
<ul>
<li>注：在 Yubikey 4 中引入了一个新功能，当用户输入正确的 PIN 码和 <strong>触摸硬件</strong> 后才会进行签名、解密或身份验证操作。具体参考 <a href="https://developers.yubico.com/PGP/Card_edit.html" target="_blank" rel="external">YubiKey 4 touch</a> 里的内容。</li>
</ul>
<h2 id="5、移动密钥到-YubiKey-4"><a href="#5、移动密钥到-YubiKey-4" class="headerlink" title="5、移动密钥到 YubiKey 4"></a>5、移动密钥到 YubiKey 4</h2><ul>
<li>注：OpenPGP Card 是支持在自身硬件上直接生成密钥对的，但多数使用 PGP 非对称加密的用户都有自己的密钥所以这里使用移动已有密钥到 YubiKey 里。直接在硬件上生成密钥对是在 admin 模式下使用 <code>generate</code> 命令，生成的密钥是无法导出备份的！</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div></pre></td><td class="code"><pre><div class="line">$ gpg --edit-key F891791F</div><div class="line"></div><div class="line">gpg (GnuPG) 2.0.30; Copyright (C) 2015 Free Software Foundation, Inc.</div><div class="line">This is free software: you are free to change and redistribute it.</div><div class="line">There is NO WARRANTY, to the extent permitted by law.</div><div class="line"></div><div class="line">Secret key is available.</div><div class="line"></div><div class="line">pub  4096R/F891791F  created: 2017-05-29  expires: never       usage: SC</div><div class="line">                     trust: ultimate      validity: ultimate</div><div class="line">sub  4096R/46D4D220  created: 2017-05-29  expires: never       usage: E</div><div class="line">sub  4096R/C10AE6D4  created: 2017-05-29  expires: never       usage: A</div><div class="line">[ultimate] (1). Test User &lt;<span class="built_in">test</span>@example.com&gt;</div><div class="line"></div><div class="line">gpg&gt; toggle</div><div class="line"></div><div class="line">sec  4096R/F891791F  created: 2017-05-29  expires: never</div><div class="line">ssb  4096R/46D4D220  created: 2017-05-29  expires: never</div><div class="line">ssb  4096R/C10AE6D4  created: 2017-05-29  expires: never</div><div class="line">(1)  Test User &lt;<span class="built_in">test</span>@example.com&gt;</div><div class="line"></div><div class="line">gpg&gt; keytocard</div><div class="line">Really move the primary key? (y/N) y</div><div class="line">Signature key ....: [none]</div><div class="line">Encryption key....: [none]</div><div class="line">Authentication key: [none]</div><div class="line"></div><div class="line">Please select <span class="built_in">where</span> to store the key:</div><div class="line">   (1) Signature key</div><div class="line">   (3) Authentication key</div><div class="line">Your selection? 1</div><div class="line"></div><div class="line">You need a passphrase to unlock the secret key <span class="keyword">for</span></div><div class="line">user: <span class="string">"Test User &lt;test@example.com&gt;"</span></div><div class="line">4096-bit RSA key, ID F891791F, created 2017-05-29</div><div class="line"></div><div class="line"></div><div class="line">sec  4096R/F891791F  created: 2017-05-29  expires: never</div><div class="line">                     card-no: 0006 00000042</div><div class="line">ssb  4096R/46D4D220  created: 2017-05-29  expires: never</div><div class="line">ssb  4096R/C10AE6D4  created: 2017-05-29  expires: never</div><div class="line">(1)  Test User &lt;<span class="built_in">test</span>@example.com&gt;</div><div class="line"></div><div class="line">gpg&gt; key 1</div><div class="line"></div><div class="line">sec  4096R/F891791F  created: 2017-05-29  expires: never</div><div class="line">                     card-no: 0006 00000042</div><div class="line">ssb* 4096R/46D4D220  created: 2017-05-29  expires: never</div><div class="line">ssb  4096R/C10AE6D4  created: 2017-05-29  expires: never</div><div class="line">(1)  Test User &lt;<span class="built_in">test</span>@example.com&gt;</div><div class="line"></div><div class="line">gpg&gt; keytocard</div><div class="line">Signature key ....: 743A 2D58 688A 9E9E B4FC  493F 70D1 D7A8 13AF CE85</div><div class="line">Encryption key....: [none]</div><div class="line">Authentication key: [none]</div><div class="line"></div><div class="line">Please select <span class="built_in">where</span> to store the key:</div><div class="line">   (2) Encryption key</div><div class="line">Your selection? 2</div><div class="line"></div><div class="line">You need a passphrase to unlock the secret key <span class="keyword">for</span></div><div class="line">user: <span class="string">"Test User &lt;test@example.com&gt;"</span></div><div class="line">4096-bit RSA key, ID 46D4D220, created 2017-05-29</div><div class="line"></div><div class="line"></div><div class="line">sec  4096R/F891791F  created: 2017-05-29  expires: never</div><div class="line">                     card-no: 0006 00000042</div><div class="line">ssb* 4096R/46D4D220  created: 2017-05-29  expires: never</div><div class="line">                     card-no: 0006 00000042</div><div class="line">ssb  4096R/C10AE6D4  created: 2017-05-29  expires: never</div><div class="line">(1)  Test User &lt;<span class="built_in">test</span>@example.com&gt;</div><div class="line"></div><div class="line">gpg&gt; key 1</div><div class="line"></div><div class="line">sec  4096R/F891791F  created: 2017-05-29  expires: never</div><div class="line">                     card-no: 0006 00000042</div><div class="line">ssb  4096R/46D4D220  created: 2017-05-29  expires: never</div><div class="line">                     card-no: 0006 00000042</div><div class="line">ssb  4096R/C10AE6D4  created: 2017-05-29  expires: never</div><div class="line">(1)  Test User &lt;<span class="built_in">test</span>@example.com&gt;</div><div class="line"></div><div class="line">gpg&gt; key 2</div><div class="line"></div><div class="line">sec  4096R/F891791F  created: 2017-05-29  expires: never</div><div class="line">                     card-no: 0006 00000042</div><div class="line">ssb  4096R/46D4D220  created: 2017-05-29  expires: never</div><div class="line">                     card-no: 0006 00000042</div><div class="line">ssb* 4096R/C10AE6D4  created: 2017-05-29  expires: never</div><div class="line">(1)  Test User &lt;<span class="built_in">test</span>@example.com&gt;</div><div class="line"></div><div class="line">gpg&gt; keytocard</div><div class="line">Signature key ....: 743A 2D58 688A 9E9E B4FC  493F 70D1 D7A8 13AF CE85</div><div class="line">Encryption key....: 8D17 89A0 5C2F B804 22E5  5C04 8A68 9CC0 D742 1CDF</div><div class="line">Authentication key: [none]</div><div class="line"></div><div class="line">Please select <span class="built_in">where</span> to store the key:</div><div class="line">   (3) Authentication key</div><div class="line">Your selection? 3</div><div class="line"></div><div class="line">You need a passphrase to unlock the secret key <span class="keyword">for</span></div><div class="line">user: <span class="string">"Test User &lt;test@example.com&gt;"</span></div><div class="line">4096-bit RSA key, ID C10AE6D4, created 2017-05-29</div><div class="line"></div><div class="line"></div><div class="line">sec  4096R/F891791F  created: 2017-05-29  expires: never</div><div class="line">                     card-no: 0006 00000042</div><div class="line">ssb  4096R/46D4D220  created: 2017-05-29  expires: never</div><div class="line">                     card-no: 0006 00000042</div><div class="line">ssb* 4096R/C10AE6D4  created: 2017-05-29  expires: never</div><div class="line">                     card-no: 0006 00000042</div><div class="line">(1)  Test User &lt;<span class="built_in">test</span>@example.com&gt;</div><div class="line"></div><div class="line">gpg&gt; quit</div><div class="line">Save changes? (y/N) y</div></pre></td></tr></table></figure>
<p>当前密钥移动到 OpenPGP 卡后就没法再导出无须硬件卡就可直接使用的密钥了，如果你在上面的步骤没有导出备份密钥，那么 OpenPGP 卡里是私钥将是你唯一的私钥且没法备份。</p>
<p>查看 OpenPGP 卡状态信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">$ gpg --card-status</div><div class="line"></div><div class="line">Application ID ...: D2760001240102000060000000420000</div><div class="line">Version ..........: 2.1</div><div class="line">Manufacturer .....: Yubico</div><div class="line">Serial number ....: 00000042</div><div class="line">Name of cardholder: Test User</div><div class="line">Language prefs ...: en</div><div class="line">Sex ..............: male</div><div class="line">URL of public key : https://www.example.com/public-key.asc</div><div class="line">Login data .......: <span class="built_in">test</span></div><div class="line">Signature PIN ....: forced</div><div class="line">Key attributes ...: 4096R 4096R 4096R</div><div class="line">Max. PIN lengths .: 127 127 127</div><div class="line">PIN retry counter : 3 3 3</div><div class="line">Signature counter : 0</div><div class="line">Signature key ....: 743A 2D58 688A 9E9E B4FC  493F 70D1 D7A8 13AF CE85</div><div class="line">      created ....: 2017-05-29 22:11:07</div><div class="line">Encryption key....: 8D17 89A0 5C2F B804 22E5  5C04 8A68 9CC0 D742 1CDF</div><div class="line">      created ....: 2017-05-29 22:11:07</div><div class="line">Authentication key: 628C 7B5D D284 224A 3321  4369 BC71 9F68 F891 791F</div><div class="line">      created ....: 2017-05-29 22:11:07</div><div class="line">General key info..: pub  4096R/F891791F 2017-05-29 Test User &lt;<span class="built_in">test</span>@example.com&gt;</div><div class="line">sec&gt;  4096R/F891791F  created: 2017-05-29  expires: never</div><div class="line">                      card-no: 0006 00000042</div><div class="line">ssb&gt;  4096R/46D4D220  created: 2017-05-29  expires: never</div><div class="line">                      card-no: 0006 00000042</div><div class="line">ssb&gt;  4096R/C10AE6D4  created: 2017-05-29  expires: never</div><div class="line">                      card-no: 0006 00000042</div></pre></td></tr></table></figure>
<h2 id="6、在其他电脑上使用"><a href="#6、在其他电脑上使用" class="headerlink" title="6、在其他电脑上使用"></a>6、在其他电脑上使用</h2><p>当你配置好了一个 YubiKey 的 OpenPGP 智能卡后你可以在其他任何支持 PGP 客户端的电脑上插上 YubiKey 使用你是私钥进行签名、加密、认证操作，而不用担心私钥泄露。</p>
<p>从文件导入公钥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gpg --import public-key.asc</div></pre></td></tr></table></figure>
<p>或者从公钥服务器上导入公钥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gpg --keyserver keys.gnupg.net --recv 0xF891791F</div></pre></td></tr></table></figure>
<p>插入 YubiKey 查看 OpenPGP 卡信息，这一步会自动映射 YubiKey 里的私钥到 OpenPGP 的配置里。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gpg --card-status</div></pre></td></tr></table></figure>
<p>设置密钥在本系统上的信任状态</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">$ gpg --edit-key F891791F</div><div class="line"></div><div class="line">gpg (GnuPG) 1.4.21; Copyright (C) 2015 Free Software Foundation, Inc.</div><div class="line">This is free software: you are free to change and redistribute it.</div><div class="line">There is NO WARRANTY, to the extent permitted by law.</div><div class="line"></div><div class="line"></div><div class="line">pub  4096R/F891791F  created: 2017-05-29  expires: never       usage: SC</div><div class="line">                     trust: ultimate      validity: ultimate</div><div class="line">sub  4096R/46D4D220  created: 2017-05-29  expires: never       usage: E</div><div class="line">sub  4096R/C10AE6D4  created: 2017-05-29  expires: never       usage: A</div><div class="line">[ unknown] (1). Test User &lt;<span class="built_in">test</span>@example.com&gt;</div><div class="line"></div><div class="line">gpg&gt; trust</div><div class="line">pub  4096R/F891791F  created: 2017-05-29  expires: never       usage: SC</div><div class="line">                     trust: unknown      validity: unknown</div><div class="line">sub  4096R/46D4D220  created: 2017-05-29  expires: never       usage: E</div><div class="line">sub  4096R/C10AE6D4  created: 2017-05-29  expires: never       usage: A</div><div class="line">[unknown] (1). Test User &lt;<span class="built_in">test</span>@example.com&gt;</div><div class="line"></div><div class="line">Please decide how far you trust this user to correctly verify other users<span class="string">' keys</span></div><div class="line">(by looking at passports, checking fingerprints from different sources, etc.)</div><div class="line"></div><div class="line">  1 = I don't know or won<span class="string">'t say</span></div><div class="line">  2 = I do NOT trust</div><div class="line">  3 = I trust marginally</div><div class="line">  4 = I trust fully</div><div class="line">  5 = I trust ultimately</div><div class="line">  m = back to the main menu</div><div class="line"></div><div class="line">Your decision? 5  // 输入 5 设置为终极信任</div><div class="line">Do you really want to set this key to ultimate trust? (y/N) y</div><div class="line"></div><div class="line">pub  4096R/F891791F  created: 2017-05-29  expires: never       usage: SC</div><div class="line">                     trust: ultimate      validity: unknown</div><div class="line">sub  4096R/46D4D220  created: 2017-05-29  expires: never       usage: E</div><div class="line">sub  4096R/C10AE6D4  created: 2017-05-29  expires: never       usage: A</div><div class="line">[unknown] (1). Test User &lt;test@example.com&gt;</div><div class="line">Please note that the shown key validity is not necessarily correct</div><div class="line">unless you restart the program.</div><div class="line"></div><div class="line">gpg&gt; q</div></pre></td></tr></table></figure>
<p>查看系统上的密钥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ gpg -k  // 查看所有的公钥</div><div class="line"></div><div class="line">~/.gnupg/pubring.gpg</div><div class="line">-----------------------------------------------</div><div class="line">pub   4096R/F891791F 2017-05-29</div><div class="line">uid       [ultimate] Test User &lt;<span class="built_in">test</span>@example.com&gt;</div><div class="line">sub   4096R/46D4D220 2017-05-29</div><div class="line">sub   4096R/C10AE6D4 2017-05-29</div><div class="line"></div><div class="line">$ gpg -K  // 查看所有的私钥</div><div class="line"></div><div class="line">~/.gnupg/secring.gpg</div><div class="line">-----------------------------------------------</div><div class="line">sec&gt;  4096R/F891791F 2017-05-29</div><div class="line">      Card serial no. = 0006 00000042  // 这里可以看出这个私钥的位置是指向 OpenPGP 智能卡的</div><div class="line">uid                  Test User &lt;<span class="built_in">test</span>@example.com&gt;</div><div class="line">ssb&gt;  4096R/46D4D220 2017-05-29</div><div class="line">ssb&gt;  4096R/C10AE6D4 2017-05-29</div></pre></td></tr></table></figure>
<p>公钥加密文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gpg -ea -r <span class="built_in">test</span>@example.com msg.txt</div></pre></td></tr></table></figure>
<p>私钥解密文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gpg msg.txt.asc</div></pre></td></tr></table></figure>
<p>文件签名</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gpg -o msg.txt.sig -ab msg.txt</div></pre></td></tr></table></figure>
<p>签名验证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gpg --verify msg.txt.sig</div></pre></td></tr></table></figure>
<h2 id="7、重置-YubiKey-4-PGP-功能"><a href="#7、重置-YubiKey-4-PGP-功能" class="headerlink" title="7、重置 YubiKey 4 PGP 功能"></a>7、重置 YubiKey 4 PGP 功能</h2><p>新建一个 <code>reset.txt</code> 的文本文件，并写入以下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">/hex</div><div class="line">scd serialno</div><div class="line">scd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40</div><div class="line">scd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40</div><div class="line">scd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40</div><div class="line">scd apdu 00 20 00 81 08 40 40 40 40 40 40 40 40</div><div class="line">scd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40</div><div class="line">scd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40</div><div class="line">scd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40</div><div class="line">scd apdu 00 20 00 83 08 40 40 40 40 40 40 40 40</div><div class="line">scd apdu 00 e6 00 00</div><div class="line">scd apdu 00 44 00 00</div><div class="line">/echo Card has been successfully reset.</div></pre></td></tr></table></figure>
<p>重置 YubiKey 4 的 OpenPGP 卡功能</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gpg-connect-agent -r reset.txt</div></pre></td></tr></table></figure>
<p>重新插拔 YubiKey 并查看 OpenPGP 卡状态信息，如果查看信息遇到错误可能是 OpenPGP 卡功能还没打开，需要通过命令手动启用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ gpg --card-status</div><div class="line"></div><div class="line">gpg: selecting openpgp failed: Card error  // OpenPGP Card 错误</div><div class="line">gpg: OpenPGP card not available: Card error</div></pre></td></tr></table></figure>
<p>启用 OpenPGP 卡功能</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">gpg-connect-agent -–hex</div><div class="line">&gt; scd apdu 00 44 00 00</div><div class="line">D[0000]  90 00                                              ..</div><div class="line">OK</div><div class="line">&gt;  // 直接回车推出</div></pre></td></tr></table></figure>
<p>手动启用 <code>OK</code> 后你可能还需要重新插拔 YubiKey 再重新查看 OpenPGP 卡状态信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">$ gpg --card-status</div><div class="line"></div><div class="line">Application ID ...: D2760001240102000060000000420000</div><div class="line">Version ..........: 2.1</div><div class="line">Manufacturer .....: Yubico</div><div class="line">Serial number ....: 00000042</div><div class="line">Name of cardholder: [not <span class="built_in">set</span>]</div><div class="line">Language prefs ...: [not <span class="built_in">set</span>]</div><div class="line">Sex ..............: unspecified</div><div class="line">URL of public key : [not <span class="built_in">set</span>]</div><div class="line">Login data .......: [not <span class="built_in">set</span>]</div><div class="line">Signature PIN ....: forced</div><div class="line">Key attributes ...: 2048R 2048R 2048R</div><div class="line">Max. PIN lengths .: 127 127 127</div><div class="line">PIN retry counter : 3 0 3</div><div class="line">Signature counter : 0</div><div class="line">Signature key ....: [none]</div><div class="line">Encryption key....: [none]</div><div class="line">Authentication key: [none]</div><div class="line">General key info..: [none]</div></pre></td></tr></table></figure>
<p>重置后的 OpenPGP 卡可以重新进行配置。</p>
<hr>
<h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><ul>
<li><a href="https://www.gnupg.org/gph/en/manual.html" target="_blank" rel="external">The GNU Privacy Handbook</a></li>
<li><a href="https://developers.yubico.com/PGP/" target="_blank" rel="external">YubiKey PGP</a></li>
<li><a href="https://www.yubico.com/support/knowledge-base/categories/articles/use-yubikey-openpgp/" target="_blank" rel="external">How to Use Your YubiKey With OpenPGP</a></li>
<li><a href="https://developers.yubico.com/yubikey-piv-manager/PIN_and_Management_Key.html" target="_blank" rel="external">PIN and Management Key</a></li>
<li><a href="https://www.yubico.com/support/knowledge-base/categories/articles/reset-applet-yubikey/" target="_blank" rel="external">How to Reset Your Applet on Your YubiKey</a></li>
<li><a href="https://developers.yubico.com/ykneo-openpgp/ResetApplet.html" target="_blank" rel="external">YubiKey ResetApplet</a></li>
<li><a href="https://openpgpcard.org/makecard/" target="_blank" rel="external">Make OpenPGP Card</a></li>
<li><a href="https://github.com/drduh/YubiKey-Guide" target="_blank" rel="external">Guide to using YubiKey as a SmartCard for GPG and SSH</a></li>
<li><a href="https://spin.atomicobject.com/2014/02/09/gnupg-openpgp-smartcard/" target="_blank" rel="external">Using an OpenPGP Smartcard with GnuPG</a></li>
<li><a href="https://www.sidorenko.io/blog/2014/11/04/yubikey-slash-openpgp-smartcards-for-newbies/" target="_blank" rel="external">Yubikey/OpenPGP Smartcards for Newbies</a></li>
<li><a href="https://www.esev.com/blog/post/2015-01-pgp-ssh-key-on-yubikey-neo/" target="_blank" rel="external">PGP and SSH keys on a Yubikey NEO</a></li>
<li><a href="https://www.jfry.me/articles/2015/gpg-smartcard/" target="_blank" rel="external">Using GPG with Smart Cards</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://znhocn.github.io/posts/2017/06/03/YubiKey-4-GPG-Tutorial/" data-id="cj3kj81e1000b1ou8gptyugim" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PGP/">PGP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/YubiKey/">YubiKey</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/posts/2017/05/26/Diary-2017-05-26/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Diary 2017-05-26</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/posts/2017/06/03/YubiKey-4-GPG-Tutorial/">YubiKey 4 PGP 功能使用教程</a>
          </li>
        
          <li>
            <a href="/posts/2017/05/26/Diary-2017-05-26/">Diary 2017-05-26</a>
          </li>
        
          <li>
            <a href="/posts/2017/05/21/Diary-2017-05-21/">Diary 2017-05-21</a>
          </li>
        
          <li>
            <a href="/posts/2017/05/17/YARD-Stick-One-Tutorial/">YARD Stick One 使用教程</a>
          </li>
        
          <li>
            <a href="/posts/2017/05/13/Diary-2017-05-13/">Diary 2017-05-13</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Diary/" style="font-size: 20px;">Diary</a> <a href="/tags/Hardware/" style="font-size: 10px;">Hardware</a> <a href="/tags/PGP/" style="font-size: 10px;">PGP</a> <a href="/tags/Radio/" style="font-size: 10px;">Radio</a> <a href="/tags/YARD-Stick-One/" style="font-size: 10px;">YARD Stick One</a> <a href="/tags/YubiKey/" style="font-size: 10px;">YubiKey</a>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 ZnHoCn<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>