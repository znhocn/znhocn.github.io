<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hacking IP Camera (和慧眼-C08) | ZnHoCn&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="和慧眼是中国移动推出的一个摄像网络监控服务平台，旗下有多款智能摄像头设备。这里我们研究使用的是 C08 型号的。IPCamera 与 WebCam 的其中一个区别是 IPCamera 不带有 Web 控制台，你只能使用厂商提供的 APP 控制设备，无法在局域网内通过网页控制设备。并且 IPCamera 基本上都要连接互联网使用厂商的云平台，这意味着你的数据都会传输到云端，还可能需要再付费租用它的云">
<meta property="og:type" content="article">
<meta property="og:title" content="Hacking IP Camera (和慧眼-C08)">
<meta property="og:url" content="https://znhocn.github.io/posts/2017/12/26/Hacking-IP-Camera-Hehuiyan-C08/index.html">
<meta property="og:site_name" content="ZnHoCn's Blog">
<meta property="og:description" content="和慧眼是中国移动推出的一个摄像网络监控服务平台，旗下有多款智能摄像头设备。这里我们研究使用的是 C08 型号的。IPCamera 与 WebCam 的其中一个区别是 IPCamera 不带有 Web 控制台，你只能使用厂商提供的 APP 控制设备，无法在局域网内通过网页控制设备。并且 IPCamera 基本上都要连接互联网使用厂商的云平台，这意味着你的数据都会传输到云端，还可能需要再付费租用它的云">
<meta property="og:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0001.jpg">
<meta property="og:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0002.jpg">
<meta property="og:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0003.jpg">
<meta property="og:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0004.png">
<meta property="og:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0005.jpg">
<meta property="og:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0006.png">
<meta property="og:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0007.png">
<meta property="og:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0008.png">
<meta property="og:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0009.png">
<meta property="og:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0010.png">
<meta property="og:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0011.png">
<meta property="og:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0012.png">
<meta property="og:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0013.png">
<meta property="og:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0014.png">
<meta property="og:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0015.png">
<meta property="og:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0016.png">
<meta property="og:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0017.png">
<meta property="og:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0018.png">
<meta property="og:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0019.png">
<meta property="og:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0020.png">
<meta property="og:updated_time" content="2018-05-30T15:31:57.725Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hacking IP Camera (和慧眼-C08)">
<meta name="twitter:description" content="和慧眼是中国移动推出的一个摄像网络监控服务平台，旗下有多款智能摄像头设备。这里我们研究使用的是 C08 型号的。IPCamera 与 WebCam 的其中一个区别是 IPCamera 不带有 Web 控制台，你只能使用厂商提供的 APP 控制设备，无法在局域网内通过网页控制设备。并且 IPCamera 基本上都要连接互联网使用厂商的云平台，这意味着你的数据都会传输到云端，还可能需要再付费租用它的云">
<meta name="twitter:image" content="https://znhocn.github.io//files.hakr.xyz/images/2017-12-26_01-0001.jpg">
  
    <link rel="alternate" href="/atom.xml" title="ZnHoCn&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <!--<link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">-->
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ZnHoCn&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="//www.hakr.xyz">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-twitter-link" class="nav-icon" href="https://twitter.com/znhocn" target="_blank" title="Twitter"></a>
        
        
          <a id="nav-github-link" class="nav-icon" href="https://github.com/znhocn" target="_blank" title="GitHub"></a>
        
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜尋"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://znhocn.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Hacking-IP-Camera-Hehuiyan-C08" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/posts/2017/12/26/Hacking-IP-Camera-Hehuiyan-C08/" class="article-date">
  <time datetime="2017-12-25T18:12:27.000Z" itemprop="datePublished">2017-12-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Hacking IP Camera (和慧眼-C08)
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://www.hehuiyan.com/" target="_blank" rel="external">和慧眼</a>是中国移动推出的一个摄像网络监控服务平台，旗下有多款智能摄像头设备。这里我们研究使用的是 C08 型号的。<br>IPCamera 与 WebCam 的其中一个区别是 IPCamera 不带有 Web 控制台，你只能使用厂商提供的 APP 控制设备，无法在局域网内通过网页控制设备。<br>并且 IPCamera 基本上都要连接互联网使用厂商的云平台，这意味着你的数据都会传输到云端，还可能需要再付费租用它的云端平台功能使用权。<br><a id="more"></a></p>
<h2 id="1-拆解硬件"><a href="#1-拆解硬件" class="headerlink" title="1 拆解硬件"></a>1 拆解硬件</h2><p><img src="//files.hakr.xyz/images/2017-12-26_01-0001.jpg" alt=""><br><img src="//files.hakr.xyz/images/2017-12-26_01-0002.jpg" alt=""></p>
<h2 id="2-串口调试"><a href="#2-串口调试" class="headerlink" title="2 串口调试"></a>2 串口调试</h2><p>我们这里使用 CP2012 USB to TTL 工具连接到设备上焊接了跳线的 UART 接口</p>
<p><img src="//files.hakr.xyz/images/2017-12-26_01-0003.jpg" alt=""></p>
<p>使用 PuTTY 客户端连接 COM 端口开始上电调试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">U-Boot 2010.06-svn2464 (Jan 21 2015 - 09:06:53)</div><div class="line">DRAM:  256 MiB</div><div class="line">gBootLogPtr:80b80008.</div><div class="line">Check spi flash controller v350... Found</div><div class="line">Spi(cs1) ID: 0xEF 0x40 0x18 0x00 0x00 0x00</div><div class="line">reset/hold pin now is RESET</div><div class="line">Spi(cs1): Block:64KB Chip:16MB Name:<span class="string">"W25Q128B"</span></div><div class="line">boot from spi</div><div class="line">boot from spi</div><div class="line">partition file version 2</div><div class="line">rootfstype squashfs root /dev/mtdblock4</div><div class="line">In:    serial</div><div class="line">Out:   serial</div><div class="line">Err:   serial</div><div class="line">TEXT_BASE:81000000</div><div class="line">state:ff,err_count:00</div><div class="line">support SD update</div><div class="line">MMC:   Card did not respond to voltage select!</div><div class="line">No EMMC device found!!!</div><div class="line">Hisilicon ETH net controler</div><div class="line">No such device: 0:1</div><div class="line">No such device: 0:1</div><div class="line">No such device: 0:2</div><div class="line">No such device: 0:2</div><div class="line">Try again use backup_serverip</div><div class="line">Hisilicon ETH net controler</div><div class="line">No such device: 0:1</div><div class="line">No such device: 0:1</div><div class="line">No such device: 0:2</div><div class="line">No such device: 0:2</div><div class="line">Failed to get info.txt</div><div class="line">Fail to get info file!</div><div class="line">Init error!</div><div class="line">Hisilicon ETH net controler</div><div class="line">No such device: 0:1</div><div class="line">No such device: 0:1</div><div class="line">No such device: 0:2</div><div class="line">No such device: 0:2</div><div class="line"><span class="comment">## Booting kernel from Legacy Image at 82000000 ...</span></div><div class="line">   Image Name:   Linux-3.0.8</div><div class="line">   Image Type:   ARM Linux Kernel Image (uncompressed)</div><div class="line">   Data Size:    1042164 Bytes = 1017.7 KiB</div><div class="line">   Load Address: 80008000</div><div class="line">   Entry Point:  80008000</div><div class="line">   Loading Kernel Image ...OK</div><div class="line">OK</div><div class="line">boot from spi</div><div class="line">partition file version 2</div><div class="line">rootfstype squashfs root /dev/mtdblock4</div><div class="line">cmdLine mem=44M console=ttyS0,115200 root=/dev/mtdblock4 rootfstype=squashfs</div><div class="line"></div><div class="line">Starting kernel ...</div><div class="line">Uncompressing Linux... <span class="keyword">done</span>, booting the kernel.</div></pre></td></tr></table></figure>
<p>尝试了多次，调试信息都是一直卡在 booting the kernel. 这，没弹出 Shell ，也没弹出登陆认证的请求。尝使用串口登陆 Shell 只能暂时放弃。</p>
<h2 id="3-网络调试"><a href="#3-网络调试" class="headerlink" title="3 网络调试"></a>3 网络调试</h2><h3 id="3-1-端口扫描"><a href="#3-1-端口扫描" class="headerlink" title="3.1 端口扫描"></a>3.1 端口扫描</h3><p>使用 Nmap 扫描设备开放端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">$ nmap -A 192.168.8.236</div><div class="line">Nmap scan report <span class="keyword">for</span> 192.168.8.236</div><div class="line">Host is up (0.0080s latency).</div><div class="line">Not shown: 997 closed ports</div><div class="line">PORT     STATE SERVICE VERSION</div><div class="line">23/tcp   open  telnet  security DVR telnetd (many brands)</div><div class="line">554/tcp  open  rtsp</div><div class="line">| fingerprint-strings:</div><div class="line">|   SIPOptions:</div><div class="line">|     RTSP/1.0 401 Unauthorized</div><div class="line">|     CSeq: 42</div><div class="line">|_    WWW-Authenticate: Basic realm=<span class="string">"MediaServer3.0"</span></div><div class="line">|_rtsp-methods: ERROR: Script execution failed (use <span class="_">-d</span> to debug)</div><div class="line">5000/tcp open  upnp?</div><div class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</div><div class="line">SF-Port554-TCP:V=7.40%I=7%D=1/4%Time=5A4E4B5D%P=arm-unknown-linux-gnueabih</div><div class="line">SF:f%r(SIPOptions,57,<span class="string">"RTSP/1\.0\x20401\x20Unauthorized\r\nCSeq:\x2042\r\nW</span></div><div class="line">SF:WW-Authenticate:\x20Basic\x20realm=\"MediaServer3\.0\"\r\n\r\n");</div><div class="line">MAC Address: E0:50:8B:35:74:02 (Zhejiang Dahua Technology)</div><div class="line">Device <span class="built_in">type</span>: general purpose</div><div class="line">Running: Linux 2.6.X|3.X</div><div class="line">OS CPE: cpe:/o:linux:linux_kernel:2.6 cpe:/o:linux:linux_kernel:3</div><div class="line">OS details: Linux 2.6.32 - 3.5</div><div class="line">Network Distance: 1 hop</div><div class="line"></div><div class="line">TRACEROUTE</div><div class="line">HOP RTT     ADDRESS</div><div class="line">1   8.00 ms 192.168.8.236</div><div class="line"></div><div class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</div><div class="line"><span class="comment"># Nmap done at Thu Jan  4 23:42:28 2018 -- 1 IP address (1 host up) scanned in 116.06 seconds</span></div></pre></td></tr></table></figure>
<p>扫描完成后看到设备上开放着 <code>23</code> <code>544</code> <code>5000</code> 3 个端口分别运行着 Telnet, RTSP, UPNP(疑似) 服务。</p>
<h3 id="3-2-网络数据包分析"><a href="#3-2-网络数据包分析" class="headerlink" title="3.2 网络数据包分析"></a>3.2 网络数据包分析</h3><p>这里使用安装了 <code>tcpdump</code> 且支持外接 USB 存储的 OpenWrt 路由器设备进行抓包。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ mount /dev/sdb1 /mnt/usb/    // 挂载 U盘</div><div class="line">$ <span class="built_in">cd</span> /mnt/usb/pcap/    // 进入 U盘挂载目录</div><div class="line">$ tcpdump -i wlan0-1 -w wlan0-1_$(date +%s).cap    // 抓取无线网卡上的数据流量</div></pre></td></tr></table></figure>
<p>抓取一段时间的数据包后使用 Wireshark 打开 <code>.pcap</code> 文件，分析 IPCamera 的数据通信流量。</p>
<p><img src="//files.hakr.xyz/images/2017-12-26_01-0004.png" alt=""></p>
<h2 id="4-固件提取"><a href="#4-固件提取" class="headerlink" title="4 固件提取"></a>4 固件提取</h2><h3 id="4-1-从-SPI-Flash-芯片里提取固件"><a href="#4-1-从-SPI-Flash-芯片里提取固件" class="headerlink" title="4.1 从 SPI Flash 芯片里提取固件"></a>4.1 从 SPI Flash 芯片里提取固件</h3><p>我们这里使用 Bus Pirate + 转接座 + SOP8 测试夹 工具来连接 SPI Flash 芯片提取固件。</p>
<p><img src="//files.hakr.xyz/images/2017-12-26_01-0005.jpg" alt=""></p>
<p>读取 SPI Flash 芯片内的数据到文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ flashrom -p buspirate_spi:dev=/dev/ttyUSB0,spispeed=1M -r flash_0.bin</div></pre></td></tr></table></figure>
<h3 id="4-2-从空气中提取固件"><a href="#4-2-从空气中提取固件" class="headerlink" title="4.2 从空气中提取固件"></a>4.2 从空气中提取固件</h3><p><strong>从空气中提取固件</strong> 在物联网时代里 OTA 固件升级模式下获得厂商原始升级固件的最佳方法！</p>
<p><a href="https://zh.wikipedia.org/wiki/%E7%A9%BA%E4%B8%AD%E7%BC%96%E7%A8%8B" target="_blank" rel="external">OTA</a>(Over-the-air) 从空中更新固件；从空气中提取固件其实就是从网络中提取固件，把更新固件时传输的所有数据包都抓取下来再重新把数据包组合起来还原固件的原始文件。这需要设备固件支持 OTA更新 才行，不过目前大多数厂商的 IoT 设备默认都有支持。</p>
<p>我们使用的这款型号的设备正好有推送新的固件更新，所以可以使用此方法获得固件。</p>
<p>这里使用安装了 <code>tcpdump</code> 且支持外接 USB 存储的 OpenWrt 路由器设备进行抓包。被抓包的设备必须连接到这路由器的 SSID 下。</p>
<p>抓取无线网卡上的数据流量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ tcpdump -i wlan0-1 -w wlan0-1_$(date +%s).cap</div></pre></td></tr></table></figure>
<p>开始抓取流量后在 APP 控制端上点击对设备固件升级(更新前最好是对 SPI Flash 先备份，以保留旧版本的固件。)</p>
<p><img src="//files.hakr.xyz/images/2017-12-26_01-0006.png" alt=""></p>
<p>把抓取的数据包中的数据流保存到文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ tcpflow -r wlan0-1_1515316239.cap</div></pre></td></tr></table></figure>
<p><img src="//files.hakr.xyz/images/2017-12-26_01-0007.png" alt=""></p>
<p>查看未知格式的的数据文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ file * | grep data</div></pre></td></tr></table></figure>
<p><img src="//files.hakr.xyz/images/2017-12-26_01-0008.png" alt=""></p>
<p>递归扫描并提取出其中已知格式的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ binwalk -Me 211.140.013.023.15050-172.016.042.116.42004</div></pre></td></tr></table></figure>
<p><img src="//files.hakr.xyz/images/2017-12-26_01-0009.png" alt=""></p>
<p>递归扫描并提取出的已知格式的文件</p>
<p><img src="//files.hakr.xyz/images/2017-12-26_01-0010.png" alt=""></p>
<h2 id="5-固件逆向"><a href="#5-固件逆向" class="headerlink" title="5 固件逆向"></a>5 固件逆向</h2><h3 id="5-1-解包固件"><a href="#5-1-解包固件" class="headerlink" title="5.1 解包固件"></a>5.1 解包固件</h3><p>从备份的 SPI Flash 数据里递归扫描并提取出其中已知格式的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ binwalk -Me flash_0.bin</div></pre></td></tr></table></figure>
<p>查看递归提取后的文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> _flash_0.bin.extracted/</div><div class="line">$ tree -L 3</div><div class="line">$ ls <span class="_">-l</span> squashfs-root*</div></pre></td></tr></table></figure>
<p><img src="//files.hakr.xyz/images/2017-12-26_01-0011.png" alt=""></p>
<p>查看 Linux 用户与密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> squashfs-root/</div><div class="line">$ <span class="built_in">cd</span> etc/</div><div class="line">$ cat passwd</div><div class="line">root:<span class="variable">$1</span><span class="variable">$jSqQv</span>.uP<span class="variable">$jgz4lwEx2pnDh4QwXkh06</span>/:0:0:root:/:/bin/sh</div></pre></td></tr></table></figure>
<p>查看 <code>passwd</code> 文件，发现系统里只有一个 root 用户，加盐后的的密码 Hash ，登陆 shell 为 <code>/bin/sh</code>。 使用 <a href="http://www.openwall.com/john/" target="_blank" rel="external">John the Ripper</a> 对 Hash 进行解码成明文密码。</p>
<p>以下是解出的密码<br>User: <code>root</code><br>Password: <code>vizxv</code></p>
<p>尝试使用这个账号登陆 Telnet 但并未成功。</p>
<h3 id="5-2-分析-Telnet"><a href="#5-2-分析-Telnet" class="headerlink" title="5.2 分析 Telnet"></a>5.2 分析 Telnet</h3><p>既然尝试使用系统用户登陆失败了，那只能从 Telnet 服务程序入手，分析它的登陆验证方式，找到正确的用户和密码。</p>
<p>查找 Telnet 服务程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> _flash_0.bin.extracted/squashfs-root/</div><div class="line">$ find ./ -name *telnet*</div><div class="line">./bin/telnet    // Telnet 客户端</div><div class="line">./sbin/telnetd    // Telnet 服务端</div></pre></td></tr></table></figure>
<p>使用 IDA Pro 对 <code>telnetd</code> 进行反汇编后发现 Telnet 的用户名和密码是硬编码在程序里的。</p>
<p><img src="//files.hakr.xyz/images/2017-12-26_01-0012.png" alt=""><br><img src="//files.hakr.xyz/images/2017-12-26_01-0013.png" alt=""></p>
<p><strong>Telnet 登陆账号</strong><br>User: <code>admin</code><br>Password: <code>7ujMko0admin</code></p>
<p>使用这个用户再次尝试登陆 Telnet </p>
<p><img src="//files.hakr.xyz/images/2017-12-26_01-0014.png" alt=""></p>
<blockquote>
<p><strong>成功了！！！</strong><br>这个我们已经获得了 Shell 与 root 权限</p>
</blockquote>
<h3 id="5-3-收集系统运行信息"><a href="#5-3-收集系统运行信息" class="headerlink" title="5.3 收集系统运行信息"></a>5.3 收集系统运行信息</h3><p>这里登陆到 Telnet 手动收集信息，相较于使用 <a href="https://github.com/craigz28/firmwalker" target="_blank" rel="external">Firewalker</a> 脚本工具收集固件解包后的信息，能收集到设备在运行状态下内存里的更多信息。</p>
<p>收集运行的进程信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">~ <span class="comment"># ps</span></div><div class="line">PID   USER     TIME   COMMAND</div><div class="line">    1 root       0:00 init</div><div class="line">    2 root       0:00 [kthreadd]</div><div class="line">    3 root       0:00 [ksoftirqd/0]</div><div class="line">    4 root       0:00 [kworker/0:0]</div><div class="line">    5 root       0:01 [kworker/u:0]</div><div class="line">    6 root       0:06 [rcu_kthread]</div><div class="line">    7 root       0:00 [khelper]</div><div class="line">    8 root       0:00 [kworker/u:1]</div><div class="line">   72 root       0:00 [sync_supers]</div><div class="line">   74 root       0:00 [bdi-default]</div><div class="line">   76 root       0:00 [kblockd]</div><div class="line">  168 root       0:00 [kswapd0]</div><div class="line">  217 root       0:00 [fsnotify_mark]</div><div class="line">  224 root       0:00 [crypto]</div><div class="line">  238 root       0:00 [mtdblock0]</div><div class="line">  243 root       0:00 [mtdblock1]</div><div class="line">  248 root       0:00 [mtdblock2]</div><div class="line">  253 root       0:00 [mtdblock3]</div><div class="line">  258 root       0:00 [mtdblock4]</div><div class="line">  263 root       0:01 [mtdblock5]</div><div class="line">  268 root       0:00 [mtdblock6]</div><div class="line">  273 root       0:00 [mtdblock7]</div><div class="line">  281 root       0:00 [kpsmoused]</div><div class="line">  282 root       0:00 [kworker/0:1]</div><div class="line">  324 root       0:00 [jffs2_gcd_mtd7]</div><div class="line">  342 root       0:00 /sbin/telnetd</div><div class="line">  397 root       0:00 [khubd]</div><div class="line">  418 root       0:00 [OSA_416_1]</div><div class="line">  478 root       0:00 [OSA_462_3]</div><div class="line">  483 root       0:00 [OSA_462_4]</div><div class="line">  502 root       0:00 syshelper elper 60</div><div class="line">  526 root       0:00 [cfg80211]</div><div class="line">  533 root       0:01 /usr/bin/wpa_supplicant -g/var/tmp/wpa_supplicant-global -P/var/tmp/eth2.pid</div><div class="line">  543 root       0:00 [kworker/u:2]</div><div class="line">  548 root       0:00 [flush-mtd-unmap]</div><div class="line">  556 root       0:54 VideoDaemon AEWB</div><div class="line">  557 root       0:00 /bin/sh /etc/init.d/appauto</div><div class="line">  581 root       0:00 /bin/sh ./usr/etc/app.sh</div><div class="line">  587 root       1:58 /usr/bin/sonia</div><div class="line">  612 root       0:01 [RTW_CMD_THREAD]</div><div class="line">  913 root       0:00 [kworker/u:3]</div><div class="line"> 1295 root       0:00 -sh</div><div class="line"> 1427 root       0:00 ps</div><div class="line">~ <span class="comment">#</span></div></pre></td></tr></table></figure>
<p>收集 Linux 版本信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">/proc <span class="comment"># cat version</span></div><div class="line">Linux version 3.0.8 (@centos-68) (gcc version 4.4.1 (Hisilicon_v100(gcc4.4-290+uclibc_0.9.30.2+eabi+linuxpthread)) )</div><div class="line">/proc <span class="comment">#</span></div></pre></td></tr></table></figure>
<p>收集处理器信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">~ <span class="comment"># cd /proc/</span></div><div class="line">/proc <span class="comment"># cat cpuinfo</span></div><div class="line">Processor       : ARM926EJ-S rev 5 (v5l)</div><div class="line">BogoMIPS        : 218.72</div><div class="line">Features        : swp half fastmult edsp java</div><div class="line">CPU implementer : 0x41</div><div class="line">CPU architecture: 5TEJ</div><div class="line">CPU variant     : 0x0</div><div class="line">CPU part        : 0x926</div><div class="line">CPU revision    : 5</div><div class="line"></div><div class="line">Hardware        : hi3518</div><div class="line">Revision        : 0000</div><div class="line">Serial          : 0000000000000000</div><div class="line">/proc <span class="comment">#</span></div></pre></td></tr></table></figure>
<p>收集内存信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">/proc <span class="comment"># cat meminfo</span></div><div class="line">MemTotal:          41604 kB</div><div class="line">MemFree:            1832 kB</div><div class="line">Buffers:            3948 kB</div><div class="line">Cached:            11636 kB</div><div class="line">SwapCached:            0 kB</div><div class="line">Active:            20528 kB</div><div class="line">Inactive:           7928 kB</div><div class="line">Active(anon):      12920 kB</div><div class="line">Inactive(anon):      296 kB</div><div class="line">Active(file):       7608 kB</div><div class="line">Inactive(file):     7632 kB</div><div class="line">Unevictable:           0 kB</div><div class="line">Mlocked:               0 kB</div><div class="line">SwapTotal:             0 kB</div><div class="line">SwapFree:              0 kB</div><div class="line">Dirty:                 0 kB</div><div class="line">Writeback:             0 kB</div><div class="line">AnonPages:         12896 kB</div><div class="line">Mapped:             7156 kB</div><div class="line">Shmem:               344 kB</div><div class="line">Slab:               3356 kB</div><div class="line">SReclaimable:        868 kB</div><div class="line">SUnreclaim:         2488 kB</div><div class="line">KernelStack:         728 kB</div><div class="line">PageTables:          476 kB</div><div class="line">NFS_Unstable:          0 kB</div><div class="line">Bounce:                0 kB</div><div class="line">WritebackTmp:          0 kB</div><div class="line">CommitLimit:       20800 kB</div><div class="line">Committed_AS:     449116 kB</div><div class="line">VmallocTotal:     966656 kB</div><div class="line">VmallocUsed:       17412 kB</div><div class="line">VmallocChunk:     931184 kB</div><div class="line">/proc <span class="comment">#</span></div></pre></td></tr></table></figure>
<p>收集 TCP 连接信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">/proc <span class="comment"># cat /proc/net/tcp</span></div><div class="line">  sl  local_address rem_address   st tx_queue rx_queue tr tm-&gt;when retrnsmt   uid  timeout inode</div><div class="line">   0: 00000000:1388 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 403 1 c2658460 300 0 0 2 -1</div><div class="line">   1: 00000000:022A 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 513 1 c2659180 300 0 0 2 -1</div><div class="line">   2: 00000000:9390 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 415 1 c26588c0 300 0 0 2 -1</div><div class="line">   3: 00000000:9391 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 412 1 c2658d20 300 0 0 2 -1</div><div class="line">   4: 00000000:0017 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 162 1 c2658000 300 0 0 2 -1</div><div class="line">   5: EC08A8C0:0017 7E08A8C0:CFA9 01 00000002:00000000 01:0000001D 00000000     0        0 1444 4 c26595e0 31 4 25 10 9</div><div class="line">   6: EC08A8C0:A135 120D8CD3:BF86 01 00001E8F:00000000 01:0000001D 00000000     0        0 1052 2 c2659ea0 31 4 0 18 7</div><div class="line">   7: EC08A8C0:B352 160D8CD3:3572 01 00000000:00000000 00:00000000 00000000     0        0 1042 1 c2659a40 21 4 30 5 3</div><div class="line">/proc <span class="comment">#</span></div></pre></td></tr></table></figure>
<p><code>local_address</code> 与 <code>rem_address</code> 都是十六进制的表示方法，并且 IP 地址是倒过来的。<br><code>6B 02 A8 C0</code> 转换成石家庄为 <code>107 2 168 192</code> 转换正常的 IPv4 地址为 <code>192.168.2.107</code>。<br><code>0017</code> 为端口号也是使用十六进制表示的，转换成十进制是 <code>23</code>。<br>闲手动麻烦可以使用 <a href="https://gist.github.com/jkstill/5095725" target="_blank" rel="external">proc_net_tcp_decode</a> 这个脚本去转换。</p>
<p>收集 UDP 连接信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">/proc <span class="comment"># cat /proc/net/udp</span></div><div class="line">  sl  local_address rem_address   st tx_queue rx_queue tr tm-&gt;when retrnsmt   uid  timeout inode ref pointer drops</div><div class="line">  146: 00000000:9392 00000000:0000 07 00000000:00000000 00:00000000 00000000     0        0 416 2 c1dcf800 0</div><div class="line">  146: 00000000:9392 00000000:0000 07 00000000:00000000 00:00000000 00000000     0        0 413 2 c1dcf600 0</div><div class="line">  178: EC08A8C0:93B2 00000000:0000 07 00000000:00000000 00:00000000 00000000     0        0 1061 2 c0b16400 0</div><div class="line">  178: FBFFFFEF:93B2 00000000:0000 07 00000000:00000000 00:00000000 00000000     0        0 1060 2 c0b16000 0</div><div class="line">  186: 00000000:13BA 00000000:0000 07 00000000:00000000 00:00000000 00000000     0        0 382 2 c1dcf400 0</div><div class="line">/proc <span class="comment">#</span></div></pre></td></tr></table></figure>
<p>收集已安装的命令行工具</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">~ <span class="comment">#</span></div><div class="line">VideoDaemon     cat             dmesg           grep            ip              <span class="built_in">log</span>View         netinit         <span class="built_in">pwd</span>             ssl/            top</div><div class="line">[               chgrp           du              halt            ipaddr          login           netinit6        reboot          <span class="built_in">stat</span>            touch</div><div class="line">[[              chmod           <span class="built_in">echo</span>            head            iplink          ls              netstat         redirClient     sync            udhcpd</div><div class="line">aewDebug        chown           egrep           hostapd         iproute         lsmod           netwifi         redir_stdio     syshelper       udpsvd</div><div class="line">appauto         chroot          env             hush            iprule          mdev            nice            rm              systools        umount</div><div class="line">armbenv         clearparam      fdisk           hwclock         iptunnel        mkdir           nslookup        rmdir           tail            uname</div><div class="line">arp             cp              fgrep           ifconfig        iwconfig        mknod           ping            rmmod           tcpsvd          unlzma</div><div class="line">arping          cut             find            ifenslave       <span class="built_in">kill</span>            mnt_jffs2       ping6           route           telnet          unzip</div><div class="line">ash             date            free            ii              killall         modinfo         pkill           sed             telnetd         vi</div><div class="line">audioDebug      dd              fsync           inetd           killall5        more            poweroff        seq             <span class="built_in">test</span>            who</div><div class="line">bash            df              gethwid         init            less            mount           printenv        sh              tftp            whoami</div><div class="line">busybox         dh_keyboard     getty           insmod          ln              mv              ps              sonia           tftpd           wpa_supplicant</div><div class="line">~ <span class="comment">#</span></div></pre></td></tr></table></figure>
<p>收集目录信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line">~ <span class="comment"># mount</span></div><div class="line">rootfs on / <span class="built_in">type</span> rootfs (rw)</div><div class="line">/dev/root on / <span class="built_in">type</span> squashfs (ro,relatime)</div><div class="line">devtmpfs on /dev <span class="built_in">type</span> devtmpfs (rw,relatime,size=20760k,nr_inodes=5190,mode=755)</div><div class="line">proc on /proc <span class="built_in">type</span> proc (rw,relatime)</div><div class="line">sysfs on /sys <span class="built_in">type</span> sysfs (rw,relatime)</div><div class="line">devpts on /dev/pts <span class="built_in">type</span> devpts (rw,relatime,mode=600,ptmxmode=000)</div><div class="line">tmpfs on /var <span class="built_in">type</span> tmpfs (rw,relatime)</div><div class="line">/dev/mtdblock5 on /usr <span class="built_in">type</span> squashfs (ro,relatime)</div><div class="line">/dev/mtdblock7 on /mnt/mtd <span class="built_in">type</span> jffs2 (rw,relatime)</div><div class="line">usbfs on /proc/bus/usb <span class="built_in">type</span> usbfs (rw,relatime)</div><div class="line">~ <span class="comment">#</span></div><div class="line">~ <span class="comment"># pwd</span></div><div class="line">/</div><div class="line">~ <span class="comment">#</span></div><div class="line">~ <span class="comment"># touch aaa</span></div><div class="line">touch: aaa: Read-only file system</div><div class="line">~ <span class="comment">#</span></div><div class="line">~ <span class="comment"># mount | grep rw</span></div><div class="line">rootfs on / <span class="built_in">type</span> rootfs (rw)</div><div class="line">devtmpfs on /dev <span class="built_in">type</span> devtmpfs (rw,relatime,size=20760k,nr_inodes=5190,mode=755)</div><div class="line">proc on /proc <span class="built_in">type</span> proc (rw,relatime)</div><div class="line">sysfs on /sys <span class="built_in">type</span> sysfs (rw,relatime)</div><div class="line">devpts on /dev/pts <span class="built_in">type</span> devpts (rw,relatime,mode=600,ptmxmode=000)</div><div class="line">tmpfs on /var <span class="built_in">type</span> tmpfs (rw,relatime)</div><div class="line">/dev/mtdblock7 on /mnt/mtd <span class="built_in">type</span> jffs2 (rw,relatime)</div><div class="line">usbfs on /proc/bus/usb <span class="built_in">type</span> usbfs (rw,relatime)</div><div class="line">~ <span class="comment">#</span></div><div class="line">~ <span class="comment"># cd /var/</span></div><div class="line">/var <span class="comment"># touch aaa</span></div><div class="line">/var <span class="comment"># ls -l</span></div><div class="line">total 0</div><div class="line">-rw-r--r--    1 root     root             0 Jan 25 04:23 aaa</div><div class="line">drwxr-xr-x   10 root     root           440 Jan 25 04:02 tmp</div><div class="line">p-wx------    1 root     root             0 Jan 25 04:00 videoDebug</div><div class="line">drwxr-xr-x    2 root     root            80 Jan 25 04:00 web</div><div class="line">/var <span class="comment">#</span></div><div class="line">/var <span class="comment"># cd /mnt/mtd/</span></div><div class="line">/mnt/mtd <span class="comment"># touch aaa</span></div><div class="line">/mnt/mtd <span class="comment"># ls -l</span></div><div class="line">total 6</div><div class="line">drwxr-xr-x    2 root     root             0 Jan  1  1970 3A</div><div class="line">drwxr-xr-x    3 root     root             0 Jan 25 04:00 Config</div><div class="line">drwxr-xr-x    2 root     root             0 Nov 11  2016 Log</div><div class="line">-rw-r--r--    1 root     root           256 Jan 25 04:25 RtcSramFile</div><div class="line">-rw-r--r--    1 root     root           256 Jan 25 04:25 RtcSramFileBackUp</div><div class="line">-rw-r--r--    1 root     root             0 Jan 25 04:27 aaa</div><div class="line">drwxr-xr-x    2 root     root             0 Jan  1  2000 audiofiles</div><div class="line">-rw-r--r--    1 root     root            36 Jan 25 04:00 flgFile</div><div class="line">-rw-r--r--    1 root     root            36 Jan 25 04:00 flgFileBackUp</div><div class="line">-rw-r--r--    1 root     root           556 Jan 25 04:15 recordSramFile</div><div class="line">-rw-r--r--    1 root     root           556 Jan 25 04:15 recordSramFileBackUp</div><div class="line">-rw-r--r--    1 root     root           256 Jan 25 04:25 socRtcSram</div><div class="line">-rw-r--r--    1 root     root           256 Jan 25 04:25 socRtcSramBackUp</div><div class="line">-rw-r--r--    1 root     root            21 Jan  1  2000 wifiModifyTime</div><div class="line">/mnt/mtd <span class="comment">#</span></div><div class="line"></div><div class="line">~ <span class="comment"># ls -l</span></div><div class="line">total 0</div><div class="line">drwxr-xr-x    2 root     root           993 Jan  1  1970 bin</div><div class="line">drwxr-xr-x    7 root     root          3200 Jan 25 04:00 dev</div><div class="line">drwxr-xr-x    4 root     root           258 Jan  1  1970 etc</div><div class="line">drwxr-xr-x    2 root     root             3 Jan  1  1970 home</div><div class="line">drwxr-xr-x    2 root     root           534 Jan  1  1970 lib</div><div class="line">lrwxrwxrwx    1 root     root            11 Jan  1  1970 linuxrc -&gt; bin/busybox</div><div class="line">drwxr-xr-x   12 root     root           170 Jan  1  1970 mnt</div><div class="line">drwxr-xr-x    2 root     root             3 Jan  1  1970 nfs</div><div class="line">dr-xr-xr-x   57 root     root             0 Jan  1  1970 proc</div><div class="line">drwxr-xr-x    2 root     root             3 Jan  1  1970 root</div><div class="line">drwxr-xr-x    2 root     root           423 Jan  1  1970 sbin</div><div class="line">drwxr-xr-x    2 root     root             3 Jan  1  1970 share</div><div class="line">drwxr-xr-x    2 root     root             3 Jan  1  1970 slave</div><div class="line">drwxr-xr-x   11 root     root             0 Jan  1  1970 sys</div><div class="line">lrwxrwxrwx    1 root     root             8 Jan  1  1970 tmp -&gt; var/tmp/</div><div class="line">drwx--x--x    9 25858    25858           96 Oct 14  2015 usr</div><div class="line">drwxrwxrwt    4 root     root           100 Jan 25 04:00 var</div><div class="line">~ <span class="comment">#</span></div></pre></td></tr></table></figure>
<p>收集网卡信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">~ <span class="comment"># ifconfig</span></div><div class="line">eth2      Link encap:Ethernet  HWaddr E0:50:8B:35:74:02</div><div class="line">          inet addr:192.168.8.236  Bcast:192.168.8.255  Mask:255.255.255.0</div><div class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</div><div class="line">          RX packets:8895 errors:0 dropped:234 overruns:0 frame:0</div><div class="line">          TX packets:35955 errors:0 dropped:0 overruns:0 carrier:0</div><div class="line">          collisions:0 txqueuelen:1000</div><div class="line">          RX bytes:894282 (873.3 KiB)  TX bytes:43996613 (41.9 MiB)</div><div class="line"></div><div class="line">lo        Link encap:Local Loopback</div><div class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</div><div class="line">          UP LOOPBACK RUNNING  MTU:16436  Metric:1</div><div class="line">          RX packets:73 errors:0 dropped:0 overruns:0 frame:0</div><div class="line">          TX packets:73 errors:0 dropped:0 overruns:0 carrier:0</div><div class="line">          collisions:0 txqueuelen:0</div><div class="line">          RX bytes:15590 (15.2 KiB)  TX bytes:15590 (15.2 KiB)</div><div class="line"></div><div class="line">~ <span class="comment">#</span></div></pre></td></tr></table></figure>
<!--
定位运行的服务与开放的端口号

由于 `netstat` 和 `lsof -i` 命令在这系统都用不了，所有只能从 `/proc/` 目录里手动收集原始信息再解码成可读信息。

-->
<!--



-->
<h3 id="5-4-找出-RTSP-用户名与密码"><a href="#5-4-找出-RTSP-用户名与密码" class="headerlink" title="5.4 找出 RTSP 用户名与密码"></a>5.4 找出 RTSP 用户名与密码</h3><p>使用 <a href="https://www.videolan.org/" target="_blank" rel="external">VLC media player</a> 连接到 IPCamera 的 RTSP 服务端，发现是个需要使用用户名和密码登陆认证的服务。</p>
<p><img src="//files.hakr.xyz/images/2017-12-26_01-0015.png" alt=""></p>
<p>使用 IDA Pro 对系统运行的几个私有程序进行反编译后发现配置文件大多都保存在 <code>/mnt/</code> 目录下。于是在 <code>/mnt/pd/product.zip</code> 文件里找到了几个账号。</p>
<p><img src="//files.hakr.xyz/images/2017-12-26_01-0016.png" alt=""></p>
<p>尝试这些账号登陆服务发现 <code>admin</code> 账号是可用的，并成功的连接到了 IPCamera 的 RTSP 服务。在 VLC media player 里能够直接看到实时视频与音频。</p>
<p><img src="//files.hakr.xyz/images/2017-12-26_01-0017.png" alt=""></p>
<h3 id="5-5-嗅探-5000-端口运行的服务"><a href="#5-5-嗅探-5000-端口运行的服务" class="headerlink" title="5.5 嗅探 5000 端口运行的服务"></a>5.5 嗅探 5000 端口运行的服务</h3><p>使用 NetCat 连接到 <code>5000</code> 端口，连接后并不返回任何信息，尝试发送字符信息也并未回复，且发送到一定字节信息后自动了关闭连接。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ nc 192.168.8.236 5000</div></pre></td></tr></table></figure>
<p>使用 <a href="https://github.com/0x90/miranda-upnp" target="_blank" rel="external">miranda-upnp</a> 工具扫描局域网内的运行着 UPnP 的设备也为发现有 IPCamera 的信息。目前未得出此端口运行的是什么服务。猜测可能是进行局域网内远程信息配置相关的。</p>
<h2 id="6-APP-逆向"><a href="#6-APP-逆向" class="headerlink" title="6 APP 逆向"></a>6 APP 逆向</h2><p>APP 里可能会保留部分有用的信息，这里尝试对其简单的分析。</p>
<h3 id="6-1-解包程序逆向代码"><a href="#6-1-解包程序逆向代码" class="headerlink" title="6.1 解包程序逆向代码"></a>6.1 解包程序逆向代码</h3><p>使用 Apktool 解包 <code>.apk</code> 文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ apktool d hhy.apk</div></pre></td></tr></table></figure>
<p>使用 dex2jar 将 <code>.dex</code> 文件转换成 <code>.class</code> 文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> hhy/assets/</div><div class="line">$ dex2jar classes.dex</div></pre></td></tr></table></figure>
<p>使用 <a href="http://jd.benow.ca/" target="_blank" rel="external">JD-GUI</a> 查看反编译后的代码</p>
<p><img src="//files.hakr.xyz/images/2017-12-26_01-0018.png" alt=""></p>
<p>这里有找到 RTSP 相关的内容</p>
<h3 id="6-2-APP-网络通信分析"><a href="#6-2-APP-网络通信分析" class="headerlink" title="6.2 APP 网络通信分析"></a>6.2 APP 网络通信分析</h3><p>可以使用 <a href="https://portswigger.net/burp" target="_blank" rel="external">Burp Suite</a> 去分析/修改 APP 网络通信的数据内容。这里不做讲解。</p>
<h2 id="7-漏洞利用"><a href="#7-漏洞利用" class="headerlink" title="7 漏洞利用"></a>7 漏洞利用</h2><h3 id="7-1-作为直播摄像头"><a href="#7-1-作为直播摄像头" class="headerlink" title="7.1 作为直播摄像头"></a>7.1 作为直播摄像头</h3><p>这个 IPCamera 上运行着 RTSP 服务，我们可以尝试把视频流导入到 <a href="https://obsproject.com/" target="_blank" rel="external">OBS</a> 里，作为直播摄像头。</p>
<p>在 OBS 里添加 RTSP 作为媒体源</p>
<p><img src="//files.hakr.xyz/images/2017-12-26_01-0019.png" alt=""></p>
<p><img src="//files.hakr.xyz/images/2017-12-26_01-0020.png" alt=""></p>
<h3 id="7-2-作为-DoS-肉鸡"><a href="#7-2-作为-DoS-肉鸡" class="headerlink" title="7.2 作为 DoS 肉鸡"></a>7.2 作为 DoS 肉鸡</h3><p>这个 IPCamera 还有空余存储，<code>/mnt/</code> 目录下也是可写的，并且系统内置可使用的 <code>tftp</code> <code>tftpd</code> 程序，你可以编写自己后门程序编译后通过 FTP 传输到设备上。</p>
<hr>
<ul>
<li>注: 在最新版本的固件里已经修复了这些漏洞</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://znhocn.github.io/posts/2017/12/26/Hacking-IP-Camera-Hehuiyan-C08/" data-id="cjht9rk76000uq8u8bxodkoih" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hacking/">Hacking</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hardware/">Hardware</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IPCamera/">IPCamera</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Reverse-Engineering/">Reverse Engineering</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/posts/2017/12/30/Annual-summary-2017/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Annual summary 2017
        
      </div>
    </a>
  
  
    <a href="/posts/2017/12/17/Hacking-Philips-Smart-Led-Ball-Lamp/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hacking 飞利浦智能球泡灯</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/posts/2018/05/05/How-to-Make-Redscale-Film/">如何製作紅色膠片 (Redscale Film)</a>
          </li>
        
          <li>
            <a href="/posts/2018/01/23/My-country-is-not-government/">我的國家不是政府</a>
          </li>
        
          <li>
            <a href="/posts/2017/12/30/Annual-summary-2017/">Annual summary 2017</a>
          </li>
        
          <li>
            <a href="/posts/2017/12/26/Hacking-IP-Camera-Hehuiyan-C08/">Hacking IP Camera (和慧眼-C08)</a>
          </li>
        
          <li>
            <a href="/posts/2017/12/17/Hacking-Philips-Smart-Led-Ball-Lamp/">Hacking 飞利浦智能球泡灯</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">標籤雲</h3>
    <div class="widget tagcloud">
      <a href="/tags/4K/" style="font-size: 10px;">4K</a> <a href="/tags/Annual-summary/" style="font-size: 15px;">Annual summary</a> <a href="/tags/ESP8266/" style="font-size: 15px;">ESP8266</a> <a href="/tags/Film/" style="font-size: 10px;">Film</a> <a href="/tags/Firmware/" style="font-size: 10px;">Firmware</a> <a href="/tags/Hacking/" style="font-size: 15px;">Hacking</a> <a href="/tags/Hardware/" style="font-size: 20px;">Hardware</a> <a href="/tags/IPCamera/" style="font-size: 10px;">IPCamera</a> <a href="/tags/Mijia/" style="font-size: 10px;">Mijia</a> <a href="/tags/PGP/" style="font-size: 10px;">PGP</a> <a href="/tags/Political/" style="font-size: 10px;">Political</a> <a href="/tags/Radio/" style="font-size: 10px;">Radio</a> <a href="/tags/Redscale/" style="font-size: 10px;">Redscale</a> <a href="/tags/Reverse-Engineering/" style="font-size: 10px;">Reverse Engineering</a> <a href="/tags/YARD-Stick-One/" style="font-size: 10px;">YARD Stick One</a> <a href="/tags/YouTube/" style="font-size: 10px;">YouTube</a> <a href="/tags/YubiKey/" style="font-size: 10px;">YubiKey</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">友情連結</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="https://blog.iternull.com" target="_blank">IterNull Blog</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 ZnHoCn<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="//www.hakr.xyz" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="/js/jquery-2.0.3.min.js" type='text/javascript'></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>